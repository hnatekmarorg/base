matrix:
  OSX_VERSION:
    - sonoma
    - ventura
    - monterey

when:
  - platform: darwin/arm64
    event: push

steps:
  - name: build_bases
    image: /bin/bash
    commands:
      - ls
      - pwd
      - packer init .
      - packer build -var macos_version=${OSX_VERSION} .
      - tart push sonoma_base gitea.hnatekmar.xyz/osx:${OSX_VERSION}-latest
      - tart prune --space-budget 25